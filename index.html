<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>FinanzApp</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #1f2937;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent: #4f46e5;
            --accent-hover: #4338ca;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        [data-theme="light"] {
            --bg-primary: #f3f4f6;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
        }
        /* Quick Mode Styles */
        #quick-mode { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: 1000; flex-direction: column; padding: 20px; padding-top: env(safe-area-inset-top, 20px); }
        body.quick-mode #quick-mode { display: flex; }
        body.quick-mode header, body.quick-mode nav, body.quick-mode main { display: none; }
        .quick-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .quick-header h2 { font-size: 20px; }
        .quick-close { background: var(--bg-card); border: none; color: var(--text-primary); width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; }
        .quick-type-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .quick-type-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-secondary); }
        .quick-type-btn.active.expense { background: var(--danger); color: white; }
        .quick-type-btn.active.income { background: var(--success); color: white; }
        .quick-amount-display { text-align: center; padding: 30px 0; }
        .quick-amount-display .amount { font-size: 48px; font-weight: 700; }
        .quick-amount-display .amount.expense { color: var(--danger); }
        .quick-amount-display .amount.income { color: var(--success); }
        .quick-numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .quick-num-btn { padding: 20px; border: none; border-radius: 10px; font-size: 24px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-primary); }
        .quick-num-btn:active { background: var(--accent); }
        .quick-categories { margin-bottom: 15px; }
        .quick-categories h4 { margin-bottom: 10px; color: var(--text-secondary); font-size: 14px; }
        .quick-cat-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .quick-cat-btn { padding: 8px 16px; border: 2px solid var(--bg-card); border-radius: 20px; background: transparent; color: var(--text-primary); font-size: 14px; cursor: pointer; }
        .quick-cat-btn.selected { border-color: var(--accent); background: var(--accent); }
        .quick-save-btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; margin-top: auto; }
        .quick-save-btn.expense { background: var(--danger); color: white; }
        .quick-save-btn.income { background: var(--success); color: white; }
        .quick-success { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--success); color: white; padding: 20px 40px; border-radius: 10px; font-size: 18px; font-weight: 600; z-index: 1001; display: none; }
        .quick-success.show { display: block; animation: fadeInOut 1.5s ease; }
        @keyframes fadeInOut { 0%, 100% { opacity: 0; } 20%, 80% { opacity: 1; } }
        /* Modal de edici√≥n */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg-card); border-radius: 12px; padding: 20px; width: 90%; max-width: 400px; }
        .modal h3 { margin-bottom: 15px; }
        .modal-actions { display: flex; gap: 10px; margin-top: 15px; }
        .modal-actions button { flex: 1; }
        /* Main App Styles */
        header { background: var(--bg-secondary); padding: 15px 20px; padding-top: calc(env(safe-area-inset-top, 0px) + 15px); display: flex; justify-content: space-between; align-items: center; }
        header h1 { font-size: 20px; font-weight: 700; }
        .header-actions { display: flex; gap: 10px; }
        .icon-btn { background: var(--bg-card); border: none; color: var(--text-primary); width: 36px; height: 36px; border-radius: 50%; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        nav { display: flex; background: var(--bg-secondary); border-top: 1px solid var(--bg-card); padding-bottom: env(safe-area-inset-bottom, 0px); }
        .nav-btn { flex: 1; padding: 12px 8px; background: none; border: none; color: var(--text-secondary); font-size: 12px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn span:first-child { font-size: 20px; }
        main { flex: 1; overflow-y: auto; overflow-x: hidden; }
        .section { display: none; padding: 15px; }
        .section.active { display: block; }
        .sub-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .sub-tab { padding: 8px 16px; background: var(--bg-card); border: none; border-radius: 20px; color: var(--text-secondary); font-size: 14px; white-space: nowrap; cursor: pointer; }
        .sub-tab.active { background: var(--accent); color: white; }
        .sub-content { display: none; }
        .sub-content.active { display: block; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        .balance-card { text-align: center; padding: 25px; }
        .balance-card h2 { font-size: 36px; font-weight: 700; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .stat-card { text-align: center; padding: 15px; }
        .stat-card.income h3 { color: var(--success); }
        .stat-card.expense h3 { color: var(--danger); }
        .stat-card small { color: var(--text-secondary); font-size: 12px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--bg-card); border-radius: 8px; color: var(--text-primary); font-size: 16px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: var(--accent); color: white; width: 100%; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-secondary { background: var(--bg-primary); color: var(--text-primary); }
        .transaction-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 8px; }
        .transaction-item .info { display: flex; flex-direction: column; flex: 1; }
        .transaction-item .name { font-weight: 600; }
        .transaction-item .details { font-size: 12px; color: var(--text-secondary); }
        .transaction-item .amount { font-weight: 700; margin-right: 10px; }
        .transaction-item .amount.income { color: var(--success); }
        .transaction-item .amount.expense { color: var(--danger); }
        .transaction-item .actions { display: flex; gap: 5px; }
        .transaction-item .actions button { padding: 5px 8px; font-size: 12px; border: none; border-radius: 4px; cursor: pointer; }
        .transaction-item .edit-btn { background: var(--accent); color: white; }
        .transaction-item .delete-btn { background: var(--danger); color: white; }
        .wallet-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 8px; }
        .wallet-item .info { display: flex; flex-direction: column; }
        .wallet-item .name { font-weight: 600; }
        .wallet-item .balance { font-size: 12px; color: var(--text-secondary); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
        .calendar-grid .day-header { font-size: 12px; color: var(--text-secondary); padding: 8px 0; }
        .calendar-grid .day { padding: 10px 0; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .calendar-grid .day.today { background: var(--accent); color: white; }
        .calendar-grid .day.has-event { position: relative; }
        .calendar-grid .day.has-event::after { content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: var(--warning); border-radius: 50%; }
        .toggle-container { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }
        .toggle { position: relative; width: 50px; height: 28px; background: var(--bg-primary); border-radius: 14px; cursor: pointer; }
        .toggle.active { background: var(--accent); }
        .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 24px; height: 24px; background: white; border-radius: 50%; transition: transform 0.2s; }
        .toggle.active::after { transform: translateX(22px); }
        .expandable-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .expandable-content { display: none; padding-top: 12px; }
        .expandable-content.active { display: block; }
        .delete-btn { background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; margin-left: 8px; }
        .categories-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .category-tag { display: inline-flex; align-items: center; padding: 6px 12px; background: var(--bg-primary); border-radius: 16px; font-size: 14px; }
    </style>
</head>
<body>
    <!-- Modal Editar Transacci√≥n -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal">
            <h3>‚úèÔ∏è Editar Transacci√≥n</h3>
            <div class="form-group"><label>Tipo</label><select id="edit-type"><option value="expense">Gasto</option><option value="income">Ingreso</option></select></div>
            <div class="form-group"><label>Importe</label><input type="number" id="edit-amount" step="0.01"></div>
            <div class="form-group"><label>Categor√≠a</label><select id="edit-category"></select></div>
            <div class="form-group"><label>Descripci√≥n</label><input type="text" id="edit-description"></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveEditTransaction()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Quick Mode UI -->
    <div id="quick-mode">
        <div class="quick-header">
            <h2>Entrada R√°pida</h2>
            <button class="quick-close" onclick="exitQuickMode()">‚úï</button>
        </div>
        <div class="quick-type-tabs">
            <button class="quick-type-btn expense active" onclick="quickSetType('expense')">Gasto</button>
            <button class="quick-type-btn income" onclick="quickSetType('income')">Ingreso</button>
        </div>
        <div class="quick-amount-display">
            <div id="quick-amount" class="amount expense">‚Ç¨0.00</div>
        </div>
        <div class="quick-categories">
            <h4>Categor√≠a</h4>
            <div id="quick-cat-grid" class="quick-cat-grid"></div>
        </div>
        <div class="quick-numpad">
            <button class="quick-num-btn" onclick="quickAddDigit('1')">1</button>
            <button class="quick-num-btn" onclick="quickAddDigit('2')">2</button>
            <button class="quick-num-btn" onclick="quickAddDigit('3')">3</button>
            <button class="quick-num-btn" onclick="quickAddDigit('4')">4</button>
            <button class="quick-num-btn" onclick="quickAddDigit('5')">5</button>
            <button class="quick-num-btn" onclick="quickAddDigit('6')">6</button>
            <button class="quick-num-btn" onclick="quickAddDigit('7')">7</button>
            <button class="quick-num-btn" onclick="quickAddDigit('8')">8</button>
            <button class="quick-num-btn" onclick="quickAddDigit('9')">9</button>
            <button class="quick-num-btn" onclick="quickAddDigit('.')">.</button>
            <button class="quick-num-btn" onclick="quickAddDigit('0')">0</button>
            <button class="quick-num-btn" onclick="quickDelete()">‚å´</button>
        </div>
        <button id="quick-save-btn" class="quick-save-btn expense" onclick="quickSave()">Guardar Gasto</button>
    </div>
    <div id="quick-success" class="quick-success">‚úì Guardado</div>

    <!-- Main App -->
    <header>
        <h1>üí∞ FinanzApp</h1>
        <div class="header-actions">
            <button class="icon-btn" onclick="enterQuickMode()" title="Modo r√°pido">‚ö°</button>
            <button class="icon-btn" onclick="toggleTheme()">üåì</button>
        </div>
    </header>
    <nav>
        <button class="nav-btn" onclick="showSection('finanzas', this)"><span>üìä</span>Finanzas</button>
        <button class="nav-btn active" onclick="showSection('transacciones', this)"><span>üí≥</span>Transacciones</button>
        <button class="nav-btn" onclick="showSection('carteras', this)"><span>üëõ</span>Carteras</button>
        <button class="nav-btn" onclick="showSection('turnos', this)"><span>üìÖ</span>Turnos</button>
    </nav>
    <main>
        <!-- FINANZAS -->
        <section id="finanzas" class="section">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showFinanzasTab('ia')">IA</button>
                <button class="sub-tab" onclick="showFinanzasTab('ajustes')">Ajustes</button>
            </div>
            <div id="finanzas-ia" class="sub-content active">
                <div class="card balance-card"><small>Balance Total</small><h2 id="total-balance">‚Ç¨0.00</h2></div>
                <div class="stats-grid">
                    <div class="card stat-card income"><h3 id="total-income">‚Ç¨0</h3><small>Ingresos</small></div>
                    <div class="card stat-card expense"><h3 id="total-expense">‚Ç¨0</h3><small>Gastos</small></div>
                </div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:10px;">üí° Recomendaci√≥n IA</h3><p id="ia-recommendation" style="font-size:13px;color:var(--text-secondary);">A√±ade transacciones para ver recomendaciones.</p></div>
            </div>
            <div id="finanzas-ajustes" class="sub-content">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üü• Categor√≠as de Gastos</h3><div id="expense-categories-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="new-expense-category" placeholder="Nueva categor√≠a..."></div><button class="btn btn-primary" onclick="addCategory('expense')">A√±adir</button></div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üü© Categor√≠as de Ingresos</h3><div id="income-categories-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="new-income-category" placeholder="Nueva categor√≠a..."></div><button class="btn btn-primary" onclick="addCategory('income')">A√±adir</button></div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üîî Notificaciones</h3><div id="notifications-list"></div></div>
            </div>
        </section>
        <!-- TRANSACCIONES -->
        <section id="transacciones" class="section active">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showTransactionTab('gastos')">Gastos</button>
                <button class="sub-tab" onclick="showTransactionTab('ultimas')">Ultimas</button>
                <button class="sub-tab" onclick="showTransactionTab('suscripciones')">Suscripciones</button>
            </div>
            <div id="trans-gastos" class="sub-content active">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìä Gastos por Categor√≠a</h3><div id="category-breakdown"></div></div>
            </div>
            <div id="trans-ultimas" class="sub-content">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìà √öltimas Transacciones</h3><div id="recent-transactions"></div></div>
            </div>
            <div id="trans-suscripciones" class="sub-content">
                <div class="card">
                    <h3 style="font-size:14px;margin-bottom:12px;">Suscripciones Activas</h3>
                    <div id="subscriptions-list"></div>
                    <div class="expandable-header" onclick="toggleExpandable('add-subscription')"><h3>+ Nueva Suscripci√≥n</h3><span>‚ñº</span></div>
                    <div id="add-subscription" class="expandable-content">
                        <div class="form-group"><label>Nombre</label><input type="text" id="sub-name"></div>
                        <div class="form-group"><label>Importe Mensual</label><input type="number" id="sub-amount" step="0.01"></div>
                        <div class="form-group"><label>Fecha Cobro</label><input type="date" id="sub-date"></div>
                        <button class="btn btn-primary" onclick="addSubscription()">Guardar</button>
                    </div>
                </div>
            </div>
        </section>
        <!-- CARTERAS -->
        <section id="carteras" class="section">
            <div class="card">
                <h3 style="font-size:14px;margin-bottom:12px;">üëõ Mis Carteras</h3>
                <div id="wallets-list"></div>
                <div class="expandable-header" onclick="toggleExpandable('add-wallet')"><h3>+ Nueva Cartera</h3><span>‚ñº</span></div>
                <div id="add-wallet" class="expandable-content">
                    <div class="form-group"><label>Nombre</label><input type="text" id="wallet-name"></div>
                    <div class="form-group"><label>Balance Inicial</label><input type="number" id="wallet-balance" step="0.01" value="0"></div>
                    <button class="btn btn-primary" onclick="addWallet()">Crear Cartera</button>
                </div>
            </div>
            <div class="card">
                <h3 style="font-size:14px;margin-bottom:12px;">‚áÑ Transferir</h3>
                <div class="form-group"><label>Desde</label><select id="transfer-from"></select></div>
                <div class="form-group"><label>Hacia</label><select id="transfer-to"></select></div>
                <div class="form-group"><label>Importe</label><input type="number" id="transfer-amount" step="0.01"></div>
                <button class="btn btn-primary" onclick="makeTransfer()">Transferir</button>
            </div>
        </section>
        <!-- TURNOS -->
        <section id="turnos" class="section">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="showTurnosTab('calendario')">Calendario</button>
                <button class="sub-tab" onclick="showTurnosTab('cumples')">Cumplea√±os</button>
                <button class="sub-tab" onclick="showTurnosTab('notas')">Notas</button>
            </div>
            <div id="turnos-calendario" class="sub-content active">
                <div class="card"><h3 id="calendar-month" style="font-size:14px;margin-bottom:12px;text-align:center;"></h3><div class="calendar-grid" id="calendar-grid"></div></div>
                <div class="expandable-header" onclick="toggleExpandable('add-event')"><h3>+ Nuevo Evento</h3><span>‚ñº</span></div>
                <div id="add-event" class="expandable-content">
                    <div class="form-group"><label>T√≠tulo</label><input type="text" id="event-title"></div>
                    <div class="form-group"><label>Fecha</label><input type="date" id="event-date"></div>
                    <button class="btn btn-primary" onclick="addEvent()">Guardar</button>
                </div>
            </div>
            <div id="turnos-cumples" class="sub-content">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üéÇ Cumplea√±os</h3><div id="birthdays-list"></div></div>
                <div class="expandable-header" onclick="toggleExpandable('add-birthday')"><h3>+ Nuevo</h3><span>‚ñº</span></div>
                <div id="add-birthday" class="expandable-content">
                    <div class="form-group"><label>Nombre</label><input type="text" id="birthday-name"></div>
                    <div class="form-group"><label>Fecha</label><input type="date" id="birthday-date"></div>
                    <button class="btn btn-primary" onclick="addBirthday()">Guardar</button>
                </div>
            </div>
            <div id="turnos-notas" class="sub-content">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìù Notas</h3><div id="notes-list"></div></div>
                <div class="expandable-header" onclick="toggleExpandable('add-note')"><h3>+ Nueva Nota</h3><span>‚ñº</span></div>
                <div id="add-note" class="expandable-content">
                    <div class="form-group"><label>T√≠tulo</label><input type="text" id="note-title"></div>
                    <div class="form-group"><label>Contenido</label><textarea id="note-content" rows="3"></textarea></div>
                    <button class="btn btn-primary" onclick="addNote()">Guardar</button>
                </div>
            </div>
        </section>
    </main>
    <script>
        let state = {
            balance: 0, totalIncome: 0, totalExpense: 0, transactions: [], wallets: [{name: 'Principal', balance: 0}],
            subscriptions: [], events: [], birthdays: [], notes: [],
            expenseCategories: ['Comida', 'Transporte', 'Ocio', 'Salud', 'Otros'],
            incomeCategories: ['Salario', 'Freelance', 'Inversiones', 'Otros'],
            quickType: 'expense', quickAmount: '0', quickCategory: null, editingIndex: -1
        };
        function loadState() { const saved = localStorage.getItem('finanzAppState'); if (saved) state = {...state, ...JSON.parse(saved)}; }
        function saveState() { localStorage.setItem('finanzAppState', JSON.stringify(state)); }
        function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme === 'light' ? '' : 'light'; localStorage.setItem('theme', document.body.dataset.theme); }
        function showSection(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active'); btn.classList.add('active');
        }
        function showFinanzasTab(tab) {
            document.querySelectorAll('#finanzas .sub-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#finanzas .sub-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active'); document.getElementById('finanzas-' + tab).classList.add('active');
        }
        function showTransactionTab(tab) {
            document.querySelectorAll('#transacciones .sub-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#transacciones .sub-content').forEach(c => c.classList.remove('active'));
            if(event && event.target) event.target.classList.add('active');
            document.getElementById('trans-' + tab).classList.add('active');
        }
        function showTurnosTab(tab) {
            document.querySelectorAll('#turnos .sub-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#turnos .sub-content').forEach(c => c.classList.remove('active'));
            if(event && event.target) event.target.classList.add('active');
            document.getElementById('turnos-' + tab).classList.add('active');
        }
        function toggleExpandable(id) { document.getElementById(id).classList.toggle('active'); }
        // Quick Mode
        function enterQuickMode() { document.body.classList.add('quick-mode'); state.quickAmount = '0'; state.quickCategory = null; state.quickType = 'expense'; updateQuickUI(); }
        function exitQuickMode() { document.body.classList.remove('quick-mode'); updateUI(); }
        function quickSetType(type) { state.quickType = type; document.querySelectorAll('.quick-type-btn').forEach(b => b.classList.remove('active')); document.querySelector('.quick-type-btn.' + type).classList.add('active'); state.quickCategory = null; updateQuickUI(); }
        function quickAddDigit(d) { if (d === '.' && state.quickAmount.includes('.')) return; if (state.quickAmount === '0' && d !== '.') state.quickAmount = d; else state.quickAmount += d; updateQuickUI(); }
        function quickDelete() { state.quickAmount = state.quickAmount.slice(0, -1) || '0'; updateQuickUI(); }
        function quickSelectCategory(cat) { state.quickCategory = cat; document.querySelectorAll('.quick-cat-btn').forEach(b => b.classList.toggle('selected', b.textContent === cat)); }
        function updateQuickUI() {
            const amt = parseFloat(state.quickAmount) || 0;
            const amtEl = document.getElementById('quick-amount'); amtEl.textContent = '‚Ç¨' + amt.toFixed(2); amtEl.className = 'amount ' + state.quickType;
            const saveBtn = document.getElementById('quick-save-btn'); saveBtn.textContent = state.quickType === 'expense' ? 'Guardar Gasto' : 'Guardar Ingreso'; saveBtn.className = 'quick-save-btn ' + state.quickType;
            const cats = state.quickType === 'expense' ? state.expenseCategories : state.incomeCategories;
            document.getElementById('quick-cat-grid').innerHTML = cats.map(c => `<button class="quick-cat-btn${state.quickCategory === c ? ' selected' : ''}" onclick="quickSelectCategory('${c}')">${c}</button>`).join('');
        }
        function quickSave() {
            const amt = parseFloat(state.quickAmount) || 0; if (amt <= 0) return;
            const cat = state.quickCategory || 'Otros';
            const trans = { type: state.quickType, amount: amt, category: cat, description: state.quickType === 'expense' ? 'Gasto r√°pido' : 'Ingreso r√°pido', wallet: state.wallets[0].name, date: new Date().toISOString() };
            state.transactions.unshift(trans);
            if (state.quickType === 'expense') { state.totalExpense += amt; state.wallets[0].balance -= amt; }
            else { state.totalIncome += amt; state.wallets[0].balance += amt; }
            state.balance = state.totalIncome - state.totalExpense;
            saveState(); state.quickAmount = '0'; state.quickCategory = null; updateQuickUI();
            const success = document.getElementById('quick-success'); success.classList.add('show'); setTimeout(() => success.classList.remove('show'), 1500);
        }
        // Editar transacciones
        function openEditModal(index) {
            state.editingIndex = index;
            const t = state.transactions[index];
            document.getElementById('edit-type').value = t.type;
            document.getElementById('edit-amount').value = t.amount;
            document.getElementById('edit-description').value = t.description;
            updateEditCategories();
            document.getElementById('edit-category').value = t.category;
            document.getElementById('edit-modal').classList.add('show');
        }
        function closeEditModal() { document.getElementById('edit-modal').classList.remove('show'); state.editingIndex = -1; }
        function updateEditCategories() {
            const type = document.getElementById('edit-type').value;
            const cats = type === 'expense' ? state.expenseCategories : state.incomeCategories;
            document.getElementById('edit-category').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        function saveEditTransaction() {
            const i = state.editingIndex; if (i < 0) return;
            const oldT = state.transactions[i];
            const newType = document.getElementById('edit-type').value;
            const newAmt = parseFloat(document.getElementById('edit-amount').value) || 0;
            const newCat = document.getElementById('edit-category').value;
            const newDesc = document.getElementById('edit-description').value;
            // Revertir el balance antiguo
            if (oldT.type === 'expense') { state.totalExpense -= oldT.amount; state.wallets[0].balance += oldT.amount; }
            else { state.totalIncome -= oldT.amount; state.wallets[0].balance -= oldT.amount; }
            // Aplicar nuevo
            state.transactions[i] = { ...oldT, type: newType, amount: newAmt, category: newCat, description: newDesc };
            if (newType === 'expense') { state.totalExpense += newAmt; state.wallets[0].balance -= newAmt; }
            else { state.totalIncome += newAmt; state.wallets[0].balance += newAmt; }
            state.balance = state.totalIncome - state.totalExpense;
            saveState(); closeEditModal(); updateUI();
        }
        function deleteTransaction(index) {
            if (!confirm('¬øEliminar esta transacci√≥n?')) return;
            const t = state.transactions[index];
            if (t.type === 'expense') { state.totalExpense -= t.amount; state.wallets[0].balance += t.amount; }
            else { state.totalIncome -= t.amount; state.wallets[0].balance -= t.amount; }
            state.transactions.splice(index, 1);
            state.balance = state.totalIncome - state.totalExpense;
            saveState(); updateUI();
        }
        // Category Functions
        function addCategory(type) {
            const input = document.getElementById('new-' + type + '-category'); const name = input.value.trim(); if (!name) return;
            if (type === 'expense' && !state.expenseCategories.includes(name)) state.expenseCategories.push(name);
            else if (type === 'income' && !state.incomeCategories.includes(name)) state.incomeCategories.push(name);
            input.value = ''; saveState(); updateUI();
        }
        function deleteCategory(type, cat) {
            if (type === 'expense') state.expenseCategories = state.expenseCategories.filter(c => c !== cat);
            else state.incomeCategories = state.incomeCategories.filter(c => c !== cat);
            saveState(); updateUI();
        }
        function addWallet() {
            const name = document.getElementById('wallet-name').value.trim();
            const balance = parseFloat(document.getElementById('wallet-balance').value) || 0;
            if (!name || state.wallets.find(w => w.name === name)) return;
            state.wallets.push({name, balance}); document.getElementById('wallet-name').value = ''; document.getElementById('wallet-balance').value = '0'; saveState(); updateUI();
        }
        function makeTransfer() {
            const from = document.getElementById('transfer-from').value; const to = document.getElementById('transfer-to').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value) || 0;
            if (!from || !to || from === to || amount <= 0) return;
            const fromWallet = state.wallets.find(w => w.name === from); const toWallet = state.wallets.find(w => w.name === to);
            if (fromWallet && toWallet) { fromWallet.balance -= amount; toWallet.balance += amount; }
            document.getElementById('transfer-amount').value = ''; saveState(); updateUI();
        }
        function addSubscription() {
            const name = document.getElementById('sub-name').value.trim(); const amount = parseFloat(document.getElementById('sub-amount').value) || 0;
            const date = document.getElementById('sub-date').value; if (!name || amount <= 0) return;
            state.subscriptions.push({name, amount, date}); document.getElementById('sub-name').value = ''; document.getElementById('sub-amount').value = ''; document.getElementById('sub-date').value = ''; saveState(); updateUI();
        }
        function addEvent() {
            const title = document.getElementById('event-title').value.trim(); const date = document.getElementById('event-date').value; if (!title || !date) return;
            state.events.push({title, date}); document.getElementById('event-title').value = ''; document.getElementById('event-date').value = ''; saveState(); updateUI();
        }
        function addBirthday() {
            const name = document.getElementById('birthday-name').value.trim(); const date = document.getElementById('birthday-date').value; if (!name || !date) return;
            state.birthdays.push({name, date}); document.getElementById('birthday-name').value = ''; document.getElementById('birthday-date').value = ''; saveState(); updateUI();
        }
        function addNote() {
            const title = document.getElementById('note-title').value.trim(); const content = document.getElementById('note-content').value.trim(); if (!title) return;
            state.notes.push({title, content, date: new Date().toISOString()}); document.getElementById('note-title').value = ''; document.getElementById('note-content').value = ''; saveState(); updateUI();
        }
        function renderCalendar() {
            const now = new Date(); const year = now.getFullYear(); const month = now.getMonth();
            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('calendar-month').textContent = monthNames[month] + ' ' + year;
            const firstDay = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate();
            const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
            let html = dayHeaders.map(d => `<div class="day-header">${d}</div>`).join('');
            for (let i = 0; i < firstDay; i++) html += '<div class="day"></div>';
            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const hasEvent = state.events.some(e => e.date === dateStr); const isToday = d === now.getDate();
                html += `<div class="day${isToday ? ' today' : ''}${hasEvent ? ' has-event' : ''}">${d}</div>`;
            }
            document.getElementById('calendar-grid').innerHTML = html;
        }
        function updateUI() {
            document.getElementById('total-balance').textContent = '‚Ç¨' + state.balance.toFixed(2);
            document.getElementById('total-income').textContent = '‚Ç¨' + state.totalIncome.toFixed(0);
            document.getElementById('total-expense').textContent = '‚Ç¨' + state.totalExpense.toFixed(0);
            const walletOptions = state.wallets.map(w => `<option value="${w.name}">${w.name}</option>`).join('');
            document.getElementById('transfer-from').innerHTML = walletOptions;
            document.getElementById('transfer-to').innerHTML = walletOptions;
            document.getElementById('wallets-list').innerHTML = state.wallets.map(w => `<div class="wallet-item"><div class="info"><span class="name">${w.name}</span><span class="balance">‚Ç¨${w.balance.toFixed(2)}</span></div></div>`).join('');
            // Transacciones con botones de editar/eliminar
            document.getElementById('recent-transactions').innerHTML = state.transactions.slice(0, 20).map((t, i) => 
                `<div class="transaction-item">
                    <div class="info"><span class="name">${t.description}</span><span class="details">${t.category} ‚Ä¢ ${new Date(t.date).toLocaleDateString()}</span></div>
                    <span class="amount ${t.type}">${t.type === 'income' ? '+' : '-'}‚Ç¨${t.amount.toFixed(2)}</span>
                    <div class="actions">
                        <button class="edit-btn" onclick="openEditModal(${i})">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteTransaction(${i})">üóëÔ∏è</button>
                    </div>
                </div>`
            ).join('') || '<p style="color:var(--text-secondary);font-size:13px;">Sin transacciones</p>';
            const expenseByCategory = {};
            state.transactions.filter(t => t.type === 'expense').forEach(t => { expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount; });
            document.getElementById('category-breakdown').innerHTML = Object.entries(expenseByCategory).map(([cat, amt]) => 
                `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bg-primary);"><span>${cat}</span><span>‚Ç¨${amt.toFixed(2)}</span></div>`
            ).join('') || '<p style="color:var(--text-secondary);font-size:13px;">Sin gastos</p>';
            document.getElementById('expense-categories-list').innerHTML = '<div class="categories-list">' + state.expenseCategories.map(c => `<span class="category-tag">${c}<button class="delete-btn" onclick="deleteCategory('expense', '${c}')">x</button></span>`).join('') + '</div>';
            document.getElementById('income-categories-list').innerHTML = '<div class="categories-list">' + state.incomeCategories.map(c => `<span class="category-tag">${c}<button class="delete-btn" onclick="deleteCategory('income', '${c}')">x</button></span>`).join('') + '</div>';
            document.getElementById('subscriptions-list').innerHTML = state.subscriptions.map(s => `<div class="transaction-item"><div class="info"><span class="name">${s.name}</span><span class="details">${s.date || 'Sin fecha'}</span></div><span class="amount expense">‚Ç¨${s.amount.toFixed(2)}/mes</span></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">Sin suscripciones</p>';
            document.getElementById('birthdays-list').innerHTML = state.birthdays.map(b => `<div class="transaction-item"><div class="info"><span class="name">${b.name}</span><span class="details">${b.date}</span></div></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">Sin cumplea√±os</p>';
            document.getElementById('notes-list').innerHTML = state.notes.map(n => `<div class="card" style="margin-bottom:8px;padding:10px;"><strong>${n.title}</strong><p style="font-size:13px;color:var(--text-secondary);margin-top:4px;">${n.content}</p></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">Sin notas</p>';
            document.getElementById('notifications-list').innerHTML = '<p style="color:var(--text-secondary);font-size:13px;">Sin notificaciones activas</p>';
            renderCalendar();
            if (state.transactions.length > 0) {
                const avgExpense = state.totalExpense / Math.max(state.transactions.filter(t => t.type === 'expense').length, 1);
                document.getElementById('ia-recommendation').textContent = `Tu gasto promedio es de ‚Ç¨${avgExpense.toFixed(2)}. ${state.totalExpense > state.totalIncome ? 'Cuidado: tus gastos superan tus ingresos.' : 'Buen trabajo manteniendo el balance positivo.'}`;
            }
        }
        document.getElementById('edit-type').addEventListener('change', updateEditCategories);
        document.addEventListener('DOMContentLoaded', () => { loadState(); if (localStorage.getItem('theme') === 'light') document.body.dataset.theme = 'light'; updateUI(); enterQuickMode(); });
    </script>
</body>
</html>
