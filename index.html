<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>FinanzApp</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="6a043b00-9e61-40c9-acd5-5056901dcf4e.jfif">
    <style>
        :root { --bg-primary: #1a1a2e; --bg-secondary: #16213e; --bg-card: #1f2937; --text-primary: #ffffff; --text-secondary: #9ca3af; --accent: #4f46e5; --accent-hover: #4338ca; --success: #10b981; --danger: #ef4444; --warning: #f59e0b; }
        [data-theme="light"] { --bg-primary: #f3f4f6; --bg-secondary: #ffffff; --bg-card: #ffffff; --text-primary: #111827; --text-secondary: #6b7280; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); display: flex; flex-direction: column; }
        #quick-mode { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: 1000; flex-direction: column; padding: 20px; padding-top: env(safe-area-inset-top); }
        body.quick-mode #quick-mode { display: flex; }
        body.quick-mode header, body.quick-mode nav, body.quick-mode main { display: none; }
        .quick-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .quick-header h2 { font-size: 20px; }
        .quick-close { background: var(--bg-card); border: none; color: var(--text-primary); width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; }
        .quick-type-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .quick-type-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-secondary); }
        .quick-type-btn.active.expense { background: var(--danger); color: white; }
        .quick-type-btn.active.income { background: var(--success); color: white; }
        .quick-amount-display { text-align: center; padding: 30px 0; }
        .quick-amount-display .amount { font-size: 48px; font-weight: 700; }
        .quick-amount-display .amount.expense { color: var(--danger); }
        .quick-amount-display .amount.income { color: var(--success); }
        .quick-numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .quick-num-btn { padding: 20px; border: none; border-radius: 10px; font-size: 24px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-primary); }
        .quick-num-btn:active { background: var(--accent); }
        .quick-categories { margin-bottom: 15px; }
        .quick-categories h4 { margin-bottom: 10px; color: var(--text-secondary); font-size: 14px; }
        .quick-cat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .quick-cat-btn { padding: 10px 5px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; background: var(--bg-card); color: var(--text-secondary); text-align: center; }
        .quick-cat-btn.active { background: var(--accent); color: white; }
        .quick-save-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; }
        .quick-save-btn.expense { background: var(--danger); color: white; }
        .quick-save-btn.income { background: var(--success); color: white; }

                /* Botones de centimos */
        .quick-cent-btns { display: flex; gap: 8px; margin-bottom: 15px; justify-content: space-around; }
        .quick-cent-btn { flex: 1; padding: 10px 5px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; background: var(--bg-secondary); color: var(--text-secondary); }
        .quick-cent-btn:active { background: var(--warning); color: black; }
        
        /* Turnos con colores */
        .turnos-selector { margin-bottom: 15px; }
        .turnos-selector h4 { margin-bottom: 10px; color: var(--text-secondary); font-size: 14px; }
                .turno-selector { display: flex; gap: 10px; flex-wrap: wrap; }
                .turno-btn { padding: 8px 15px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-primary); transition: all 0.2s; }
                .turno-btn:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
                .turno-btn.active { background: var(--accent); color: white; }
                .calendar-day.shift-morning { background: linear-gradient(135deg, #4dabf7 0%, #74c0fc 100%); color: white; }
                .calendar-day.shift-afternoon { background: linear-gradient(135deg, #51cf66 0%, #8ce99a 100%); color: white; }
                .calendar-day.shift-night { background: linear-gradient(135deg, #862e9c 0%, #be4bdb 100%); color: white; }
        .turno-btns { display: flex; gap: 8px; }
        .turno-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: var(--bg-card); color: var(--text-secondary); border: 2px solid transparent; }
        .turno-btn.active.manana { background: #3b82f6; color: white; border-color: #2563eb; }
        .turno-btn.active.tarde { background: #10b981; color: white; border-color: #059669; }
        .turno-btn.active.noche { background: #ef4444; color: white; border-color: #dc2626; }
        
        /* Indicadores de calendario mejorados */
        .calendar-grid .day.has-turno::before { content: ''; position: absolute; top: 2px; right: 2px; width: 8px; height: 8px; border-radius: 50%; }
        .calendar-grid .day.has-turno.manana::before { background: #3b82f6; }
        .calendar-grid .day.has-turno.tarde::before { background: #10b981; }
        .calendar-grid .day.has-turno.noche::before { background: #ef4444; }
        #quick-success { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--success); color: white; padding: 20px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; z-index: 1001; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border-radius: 16px; padding: 24px; width: 100%; max-width: 400px; }
        .modal h3 { margin-bottom: 20px; font-size: 18px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--bg-secondary); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 16px; }
        .modal-actions { display: flex; gap: 12px; margin-top: 20px; }
        .modal-actions button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        header { background: var(--bg-secondary); padding: 16px 20px; padding-top: calc(env(safe-area-inset-top) + 16px); display: flex; justify-content: space-between; align-items: center; }
        header h1 { font-size: 20px; }
        .header-actions { display: flex; gap: 10px; }
        .icon-btn { background: var(--bg-card); border: none; color: var(--text-primary); width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; }
        nav { background: var(--bg-secondary); display: flex; border-top: 1px solid var(--bg-card); }
        .nav-btn { flex: 1; padding: 12px 8px; border: none; background: none; color: var(--text-secondary); font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn span:first-child { font-size: 20px; }
        main { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }
        .section { display: none; }
        .section.active { display: block; }
        .sub-tabs { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; }
        .sub-tab { padding: 8px 16px; border: none; border-radius: 20px; background: var(--bg-card); color: var(--text-secondary); font-size: 14px; cursor: pointer; white-space: nowrap; }
        .sub-tab.active { background: var(--accent); color: white; }
        .sub-content { display: none; }
        .sub-content.active { display: block; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .balance-card { text-align: center; padding: 24px; }
        .balance-card small { color: var(--text-secondary); }
        .balance-card h2 { font-size: 32px; margin-top: 8px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        .stat-card { text-align: center; padding: 16px; }
        .stat-card.income h3 { color: var(--success); }
        .stat-card.expense h3 { color: var(--danger); }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: var(--accent); color: white; width: 100%; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-secondary { background: var(--bg-primary); color: var(--text-primary); }
        .btn-warning { background: var(--warning); color: black; }
        .transaction-item, .notification-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 8px; }
        .transaction-item .info, .notification-item .info { display: flex; flex-direction: column; flex: 1; }
        .transaction-item .name, .notification-item .title { font-weight: 600; }
        .transaction-item .details, .notification-item .details { font-size: 12px; color: var(--text-secondary); }
        .transaction-item .amount { font-weight: 700; margin-right: 10px; }
        .transaction-item .amount.income { color: var(--success); }
        .transaction-item .amount.expense { color: var(--danger); }
        .actions { display: flex; gap: 5px; }
        .actions button { padding: 5px 8px; font-size: 12px; border: none; border-radius: 4px; cursor: pointer; }
        .edit-btn { background: var(--accent); color: white; }
        .delete-btn { background: var(--danger); color: white; }
        .export-btn { background: var(--warning); color: black; }
        .wallet-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 8px; }
        .wallet-item .info { display: flex; flex-direction: column; }
        .wallet-item .name { font-weight: 600; }
        .wallet-item .balance { font-size: 12px; color: var(--text-secondary); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
        .calendar-grid .day-header { font-size: 12px; color: var(--text-secondary); padding: 8px 0; }
        .calendar-grid .day { padding: 10px 0; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .calendar-grid .day.today { background: var(--accent); color: white; }
        .calendar-grid .day.has-event { position: relative; }
        .calendar-grid .day.has-event::after { content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: var(--warning); border-radius: 50%; }
        .categories-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .category-tag { display: inline-flex; align-items: center; padding: 6px 12px; background: var(--bg-primary); border-radius: 16px; font-size: 14px; }
        .category-tag .delete-btn { margin-left: 8px; padding: 2px 6px; }
        .notif-status { font-size: 12px; color: var(--text-secondary); margin-top: 8px; }
        .notif-status.granted { color: var(--success); }
        .notif-status.denied { color: var(--danger); }
        .export-calendar-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 14px; margin-top: 12px; background: linear-gradient(135deg, var(--warning), #e67e22); color: black; font-weight: 700; }
    </style>
</head>
<body>
    <!-- Modal Editar Transaccion -->
    <div id="edit-modal" class="modal-overlay"><div class="modal"><h3>‚úèÔ∏è Editar Transacci√≥n</h3>
        <div class="form-group"><label>Tipo</label><select id="edit-type"><option value="expense">Gasto</option><option value="income">Ingreso</option></select></div>
        <div class="form-group"><label>Importe</label><input type="number" id="edit-amount" step="0.01"></div>
        <div class="form-group"><label>Categor√≠a</label><select id="edit-category"></select></div>
        <div class="form-group"><label>Descripci√≥n</label><input type="text" id="edit-description"></div>
        <div class="modal-actions"><button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button><button class="btn btn-primary" onclick="saveEditTransaction()">Guardar</button></div>
    </div></div>

    <!-- Modal Notificacion -->
    <div id="notif-modal" class="modal-overlay"><div class="modal"><h3 id="notif-modal-title">üîî Nueva Notificaci√≥n</h3>
        <div class="form-group"><label>T√≠tulo</label><input type="text" id="notif-title" placeholder="Ej: Pagar factura"></div>
        <div class="form-group"><label>Descripci√≥n</label><input type="text" id="notif-desc" placeholder="Detalles..."></div>
        <div class="form-group"><label>Fecha y Hora</label><input type="datetime-local" id="notif-datetime"></div>
        <div class="form-group"><label>Repetir</label><select id="notif-repeat"><option value="none">No repetir</option><option value="daily">Diario</option><option value="weekly">Semanal</option><option value="monthly">Mensual</option></select></div>
        <div class="modal-actions"><button class="btn btn-secondary" onclick="closeNotifModal()">Cancelar</button><button class="btn btn-primary" onclick="saveNotification()">Guardar</button></div>
    </div></div>

    <!-- Quick Mode -->
    <div id="quick-mode"><div class="quick-header"><h2>Entrada R√°pida</h2><button class="quick-close" onclick="exitQuickMode()">‚úï</button></div>
        <div class="quick-type-tabs"><button class="quick-type-btn expense active" onclick="quickSetType('expense')">Gasto</button><button class="quick-type-btn income" onclick="quickSetType('income')">Ingreso</button></div>
        <div class="quick-amount-display"><div id="quick-amount" class="amount expense">‚Ç¨0.00</div></div>
        <div class="quick-categories"><h4>Categor√≠a</h4><div id="quick-cat-grid" class="quick-cat-grid"></div></div>
            <div class="quick-numpad"><button class="quick-num-btn" onclick="quickSetAmount(1)">‚Ç¨1</button><button class="quick-num-btn" onclick="quickSetAmount(2)">‚Ç¨2</button><button class="quick-num-btn" onclick="quickSetAmount(5)">‚Ç¨5</button><button class="quick-num-btn" onclick="quickSetAmount(10)">‚Ç¨10</button><button class="quick-num-btn" onclick="quickSetAmount(20)">‚Ç¨20</button><button class="quick-num-btn" onclick="quickSetAmount(50)">‚Ç¨50</button><button class="quick-num-btn" onclick="quickSetAmount(100)">‚Ç¨100</button><button class="quick-num-btn" onclick="quickSetAmount(200)">‚Ç¨200</button><button class="quick-num-btn" onclick="quickClear()">C</button></div>
        <button id="quick-save-btn" class="quick-save-btn expense" onclick="quickSave()">Guardar Gasto</button>
    </div>
    <div id="quick-success">‚úì Guardado</div>
                <!-- Botones rapidos de centimos (solo para gastos) -->
            <div class="quick-cent-btns" id="quick-cent-btns" style="display:none;">
                <button class="quick-cent-btn" onclick="quickAddCents(0.01)">+0.01‚Ç¨</button>
                <button class="quick-cent-btn" onclick="quickAddCents(0.10)">+0.10‚Ç¨</button>
                <button class="quick-cent-btn" onclick="quickAddCents(0.20)">+0.20‚Ç¨</button>
                <button class="quick-cent-btn" onclick="quickAddCents(0.50)">+0.50‚Ç¨</button>
            </div>


    <!-- Main App -->
    <header><h1>üí∞ FinanzApp</h1><div class="header-actions"><button class="icon-btn" onclick="enterQuickMode()">‚ö°</button><button class="icon-btn" onclick="toggleTheme()">üåô</button></div></header>
    <nav>
        <button class="nav-btn" onclick="showSection('finanzas', this)"><span>üìä</span>Finanzas</button>
        <button class="nav-btn active" onclick="showSection('transacciones', this)"><span>üí≥</span>Transacciones</button>
        <button class="nav-btn" onclick="showSection('carteras', this)"><span>üî¥</span>Carteras</button>
        <button class="nav-btn" onclick="showSection('turnos', this)"><span>üìÖ</span>Turnos</button>
    </nav>
    <main>
        <!-- Finanzas Section -->
        <section id="finanzas" class="section">
            <div class="sub-tabs"><button class="sub-tab active" onclick="showFinanzasTab('ia')">IA</button><button class="sub-tab" onclick="showFinanzasTab('ajustes')">Ajustes</button></div>
            <div id="finanzas-ia" class="sub-content active">
                <div class="card balance-card"><small>Balance Total</small><h2 id="total-balance">‚Ç¨0.00</h2></div>
                <div class="stats-grid"><div class="card stat-card income"><h3 id="total-income">‚Ç¨0</h3><small>Ingresos</small></div><div class="card stat-card expense"><h3 id="total-expense">‚Ç¨0</h3><small>Gastos</small></div></div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:10px;">üí° Recomendaci√≥n IA</h3><p id="ia-recommendation" style="font-size:13px;color:var(--text-secondary);">A√±ade transacciones para obtener recomendaciones.</p></div>
            </div>
            <div id="finanzas-ajustes" class="sub-content">
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üü• Categor√≠as de Gastos</h3><div id="expense-categories-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="new-expense-cat" placeholder="Nueva categor√≠a..."><button class="btn btn-primary" style="margin-top:8px;" onclick="addCategory('expense')">A√±adir</button></div></div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üü© Categor√≠as de Ingresos</h3><div id="income-categories-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="new-income-cat" placeholder="Nueva categor√≠a..."><button class="btn btn-primary" style="margin-top:8px;" onclick="addCategory('income')">A√±adir</button></div></div>
                <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üîî Notificaciones</h3><div id="notif-status" class="notif-status"></div><button class="btn btn-primary" style="margin-top:8px;margin-bottom:12px;" onclick="requestNotificationPermission()">Activar Notificaciones Push</button><div id="notifications-list"></div><button class="btn btn-secondary" style="margin-top:12px;width:100%;" onclick="openNotifModal()">+ A√±adir Notificaci√≥n</button><button class="btn export-calendar-btn" onclick="exportAllToCalendar()">üìÖ Exportar Todo a Calendars</button></div>
            </div>
        </section>

        <!-- Transacciones Section -->
        <section id="transacciones" class="section active">
            <div class="sub-tabs"><button class="sub-tab active" onclick="showTransactionTab('gastos')">Gastos</button><button class="sub-tab" onclick="showTransactionTab('ultimas')">Ultimas</button><button class="sub-tab" onclick="showTransactionTab('suscripciones')">Suscripciones</button></div>
            <div id="trans-gastos" class="sub-content active"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìä Gastos por Categor√≠a</h3><div id="category-breakdown"></div></div></div>
            <div id="trans-ultimas" class="sub-content"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üïí √öltimas Transacciones</h3><div id="recent-transactions"></div></div></div>
            <div id="trans-suscripciones" class="sub-content"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üîÑ Suscripciones Activas</h3><div id="subscriptions-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="sub-name" placeholder="Nombre"><input type="number" id="sub-amount" placeholder="Importe" style="margin-top:8px;"><button class="btn btn-primary" style="margin-top:8px;" onclick="addSubscription()">A√±adir Suscripci√≥n</button></div></div></div>
        </section>

        <!-- Carteras Section -->
        <section id="carteras" class="section">
            <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üí≥ Mis Carteras</h3><div id="wallets-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="wallet-name" placeholder="Nombre cartera"><input type="number" id="wallet-balance" placeholder="Balance inicial" style="margin-top:8px;"><button class="btn btn-primary" style="margin-top:8px;" onclick="addWallet()">A√±adir Cartera</button></div></div>
            <div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üîÑ Transferir</h3><div class="form-group"><select id="transfer-from"></select><select id="transfer-to" style="margin-top:8px;"></select><input type="number" id="transfer-amount" placeholder="Importe" style="margin-top:8px;"><button class="btn btn-primary" style="margin-top:8px;" onclick="makeTransfer()">Transferir</button></div></div>
        </section>

        <!-- Turnos Section -->
        <section id="turnos" class="section">
            <div class="sub-tabs"><button class="sub-tab active" onclick="showTurnosTab('calendario')">Calendario</button><button class="sub-tab" onclick="showTurnosTab('eventos')">Eventos</button><button class="sub-tab" onclick="showTurnosTab('cumples')">Cumplea√±os</button><button class="sub-tab" onclick="showTurnosTab('notas')">Notas</button></div>
            <div id="turnos-calendario" class="sub-content active"><div class="card"><h3 id="calendar-month" style="font-size:14px;margin-bottom:12px;"></h3><div id="calendar-grid" class="calendar-grid"></div></div></div>
                            <div class="card" style="margin-bottom:15px;">
                                                    <h3 style="font-size:14px;margin-bottom:10px;">‚öôÔ∏è Seleccionar Turno</h3>
                                                    <div class="turno-selector">
                                                                                <button class="turno-btn" onclick="selectShiftType('morning')">üåÖ Ma√±ana</button>
                                                                                <button class="turno-btn" onclick="selectShiftType('afternoon')">üåá Tarde</button>
                                                                                <button class="turno-btn" onclick="selectShiftType('night')">üåÉ Noche</button>
                                                                                <button class="turno-btn" onclick="clearShiftSelection()">‚ùå Limpiar</button>
                                                                            </div>
                                                </div>
            <div id="turnos-eventos" class="sub-content"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìÖ Eventos</h3><div id="events-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="event-title" placeholder="T√≠tulo evento"><input type="date" id="event-date" style="margin-top:8px;"><button class="btn btn-primary" style="margin-top:8px;" onclick="addEvent()">A√±adir Evento</button></div><button class="btn export-calendar-btn" onclick="exportEventsToCalendar()">üìÖ Exportar Eventos a Calendars</button></div></div>
            <div id="turnos-cumples" class="sub-content"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üéÇ Cumplea√±os</h3><div id="birthdays-list"></div><div class="form-group" style="margin-top:12px;"><input type="text" id="birthday-name" placeholder="Nombre"><input type="date" id="birthday-date" style="margin-top:8px;"><button class="btn btn-primary" style="margin-top:8px;" onclick="addBirthday()">A√±adir Cumplea√±os</button></div><button class="btn export-calendar-btn" onclick="exportBirthdaysToCalendar()">üéÇ Exportar Cumplea√±os a Calendars</button></div></div>
            <div id="turnos-notas" class="sub-content"><div class="card"><h3 style="font-size:14px;margin-bottom:12px;">üìù Notas</h3><div id="notes-list"></div><div class="form-group" style="margin-top:12px;"><textarea id="note-text" placeholder="Escribe tu nota..." style="width:100%;padding:12px;border:1px solid var(--bg-secondary);border-radius:8px;background:var(--bg-secondary);color:var(--text-primary);min-height:80px;"></textarea><button class="btn btn-primary" style="margin-top:8px;" onclick="addNote()">Guardar Nota</button></div></div></div>
        </section>
    </main>

    <script>
        let state = {
            theme: 'dark',
            balance: 0,
            transactions: [],
            expenseCategories: ['Comida', 'Transporte', 'Ocio', 'Salud', 'Hogar', 'Ropa', 'Otros'],
            incomeCategories: ['Salario', 'Freelance', 'Inversiones', 'Regalos', 'Otros'],
            wallets: [],
            subscriptions: [],
            events: [],
            birthdays: [],
            notes: [],
                turnos: {},
                dayNotes: {},
            notifications: [],
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };
        let selectedShift = null;
        let editingIndex = -1;
        let editingNotifIndex = -1;
        let quickType = 'expense';
        let quickAmount = '';
        let quickCategory = '';

        function loadState() {
            const saved = localStorage.getItem('finanzAppState');
            if (saved) { state = { ...state, ...JSON.parse(saved) }; }
        }
        function saveState() { localStorage.setItem('finanzAppState', JSON.stringify(state)); }

        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', state.theme);
            saveState();
        }

        function selectShiftType(type) {
                selectedShift = type;
                document.querySelectorAll('.turno-btn').forEach(btn => btn.classList.remove('active'));
                if (type) event.target.classList.add('active');
            }

        function clearShiftSelection() {
                selectedShift = null;
                document.querySelectorAll('.turno-btn').forEach(btn => btn.classList.remove('active'));
            }

        function showSection(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function showFinanzasTab(tab) {
            document.querySelectorAll('#finanzas .sub-content').forEach(c => c.classList.remove('active'));
            document.getElementById('finanzas-' + tab).classList.add('active');
            document.querySelectorAll('#finanzas .sub-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showTransactionTab(tab) {
            document.querySelectorAll('#transacciones .sub-content').forEach(c => c.classList.remove('active'));
            document.getElementById('trans-' + tab).classList.add('active');
            document.querySelectorAll('#transacciones .sub-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showTurnosTab(tab) {
            document.querySelectorAll('#turnos .sub-content').forEach(c => c.classList.remove('active'));
            document.getElementById('turnos-' + tab).classList.add('active');
            document.querySelectorAll('#turnos .sub-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            if (tab === 'calendario') renderCalendar();
        }

        // Quick Mode Functions
        function enterQuickMode() {
            document.body.classList.add('quick-mode');
            quickType = 'expense'; quickAmount = ''; quickCategory = '';
            updateQuickUI();
        }
        function exitQuickMode() { document.body.classList.remove('quick-mode'); updateUI(); }
        function quickSetType(type) {
            quickType = type;
            document.querySelectorAll('.quick-type-btn').forEach(b => { b.classList.remove('active'); if (b.classList.contains(type)) b.classList.add('active'); });
            updateQuickUI();
        }
        function quickSetAmount(amt) {
        quickAmount = amt.toString(); updateQuickUI();
        }
            function quickClear() { quickAmount = ''; updateQuickUI();  }
        
      function quickSelectCategory(cat, el) {
            quickCategory = cat;
            document.querySelectorAll('.quick-cat-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
        function updateQuickUI() {
            const amt = parseFloat(quickAmount) || 0;
            const amtEl = document.getElementById('quick-amount');
            amtEl.textContent = '‚Ç¨' + amt.toFixed(2);
            amtEl.className = 'amount ' + quickType;
            const saveBtn = document.getElementById('quick-save-btn');
            saveBtn.className = 'quick-save-btn ' + quickType;
            saveBtn.textContent = 'Guardar ' + (quickType === 'expense' ? 'Gasto' : 'Ingreso');
            const cats = quickType === 'expense' ? state.expenseCategories : state.incomeCategories;
            const grid = document.getElementById('quick-cat-grid');
            grid.innerHTML = cats.map(c => `<button class="quick-cat-btn${quickCategory === c ? ' active' : ''}" onclick="quickSelectCategory('${c}',this)</button>`).join('');
        }
        function quickSave() {
            const amt = parseFloat(quickAmount);
            if (!amt || !quickCategory) { alert('Ingresa importe y categor√≠a'); return; }
            state.transactions.unshift({ type: quickType, amount: amt, category: quickCategory, description: '', date: new Date().toISOString() });
            if (quickType === 'expense') state.balance -= amt; else state.balance += amt;
            saveState();
            document.getElementById('quick-success').style.display = 'block';
            setTimeout(() => { document.getElementById('quick-success').style.display = 'none'; }, 1000);
            quickAmount = ''; quickCategory = ''; updateQuickUI();
        }

        // Transaction Edit Functions
        function openEditModal(index) {
            editingIndex = index;
            const t = state.transactions[index];
            document.getElementById('edit-type').value = t.type;
            document.getElementById('edit-amount').value = t.amount;
            document.getElementById('edit-description').value = t.description || '';
            updateEditCategories();
            document.getElementById('edit-category').value = t.category;
            document.getElementById('edit-modal').classList.add('active');
        }
        function closeEditModal() { document.getElementById('edit-modal').classList.remove('active'); editingIndex = -1; }
        function updateEditCategories() {
            const type = document.getElementById('edit-type').value;
            const cats = type === 'expense' ? state.expenseCategories : state.incomeCategories;
            document.getElementById('edit-category').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        function saveEditTransaction() {
            const t = state.transactions[editingIndex];
            const oldType = t.type, oldAmt = t.amount;
            const newType = document.getElementById('edit-type').value;
            const newAmt = parseFloat(document.getElementById('edit-amount').value);
            if (oldType === 'expense') state.balance += oldAmt; else state.balance -= oldAmt;
            if (newType === 'expense') state.balance -= newAmt; else state.balance += newAmt;
            t.type = newType; t.amount = newAmt;
            t.category = document.getElementById('edit-category').value;
            t.description = document.getElementById('edit-description').value;
            saveState(); closeEditModal(); updateUI();
        }
        function deleteTransaction(index) {
            if (!confirm('¬øEliminar esta transacci√≥n?')) return;
            const t = state.transactions[index];
            if (t.type === 'expense') state.balance += t.amount; else state.balance -= t.amount;
            state.transactions.splice(index, 1);
            saveState(); updateUI();
        }

        // Notification Functions
        function openNotifModal(index = -1) {
            editingNotifIndex = index;
            if (index >= 0) {
                const n = state.notifications[index];
                document.getElementById('notif-modal-title').textContent = '‚úèÔ∏è Editar Notificaci√≥n';
                document.getElementById('notif-title').value = n.title;
                document.getElementById('notif-desc').value = n.description || '';
                document.getElementById('notif-datetime').value = n.datetime || '';
                document.getElementById('notif-repeat').value = n.repeat || 'none';
            } else {
                document.getElementById('notif-modal-title').textContent = 'üîî Nueva Notificaci√≥n';
                document.getElementById('notif-title').value = '';
                document.getElementById('notif-desc').value = '';
                document.getElementById('notif-datetime').value = '';
                document.getElementById('notif-repeat').value = 'none';
            }
            document.getElementById('notif-modal').classList.add('active');
        }
        function closeNotifModal() { document.getElementById('notif-modal').classList.remove('active'); editingNotifIndex = -1; }
        function saveNotification() {
            const title = document.getElementById('notif-title').value.trim();
            const desc = document.getElementById('notif-desc').value.trim();
            const datetime = document.getElementById('notif-datetime').value;
            const repeat = document.getElementById('notif-repeat').value;
            if (!title) { alert('Ingresa un t√≠tulo'); return; }
            const notif = { title, description: desc, datetime, repeat, id: Date.now() };
            if (editingNotifIndex >= 0) { state.notifications[editingNotifIndex] = notif; }
            else { state.notifications.push(notif); }
            saveState(); closeNotifModal(); updateUI();
        }
        function deleteNotification(index) {
            if (!confirm('¬øEliminar esta notificaci√≥n?')) return;
            state.notifications.splice(index, 1);
            saveState(); updateUI();
        }
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(perm => {
                    updateNotifStatus();
                    if (perm === 'granted') { new Notification('FinanzApp', { body: '¬°Notificaciones activadas!' }); }
                });
            } else { alert('Tu navegador no soporta notificaciones'); }
        }
        function updateNotifStatus() {
            const el = document.getElementById('notif-status');
            if ('Notification' in window) {
                const perm = Notification.permission;
                if (perm === 'granted') { el.textContent = '‚úÖ Notificaciones activadas'; el.className = 'notif-status granted'; }
                else if (perm === 'denied') { el.textContent = '‚ùå Notificaciones bloqueadas'; el.className = 'notif-status denied'; }
                else { el.textContent = '‚ö†Ô∏è Permiso pendiente'; el.className = 'notif-status'; }
            } else { el.textContent = 'No soportado'; el.className = 'notif-status'; }
        }

        // Calendar Export Functions (ICS format for Calendars app)
        function generateICS(events) {
            let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//FinanzApp//ES\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n';
            events.forEach(e => {
                const uid = 'finanzapp-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                const dtstart = e.date.replace(/-/g, '');
                const dtend = dtstart;
                ics += 'BEGIN:VEVENT\n';
                ics += 'UID:' + uid + '\n';
                ics += 'DTSTART;VALUE=DATE:' + dtstart + '\n';
                ics += 'DTEND;VALUE=DATE:' + dtend + '\n';
                ics += 'SUMMARY:' + e.title + '\n';
                if (e.description) ics += 'DESCRIPTION:' + e.description + '\n';
                if (e.alarm) ics += 'BEGIN:VALARM\nACTION:DISPLAY\nTRIGGER:-P1D\nDESCRIPTION:Recordatorio\nEND:VALARM\n';
                ics += 'END:VEVENT\n';
            });
            ics += 'END:VCALENDAR';
            return ics;
        }

        function downloadICS(filename, content) {
            const blob = new Blob([content], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportEventsToCalendar() {
            if (state.events.length === 0) { alert('No hay eventos para exportar'); return; }
            const events = state.events.map(e => ({ title: e.title, date: e.date, description: '', alarm: true }));
            const ics = generateICS(events);
            downloadICS('finanzapp-eventos.ics', ics);
        }

        function exportBirthdaysToCalendar() {
            if (state.birthdays.length === 0) { alert('No hay cumplea√±os para exportar'); return; }
            const currentYear = new Date().getFullYear();
            const events = state.birthdays.map(b => {
                const monthDay = b.date.slice(5);
                return { title: 'üéÇ Cumplea√±os de ' + b.name, date: currentYear + '-' + monthDay, description: 'Cumplea√±os de ' + b.name, alarm: true };
            });
            const ics = generateICS(events);
            downloadICS('finanzapp-cumples.ics', ics);
        }

        function exportAllToCalendar() {
            let allEvents = [];
            // Add notifications
            state.notifications.forEach(n => {
                if (n.datetime) {
                    const dateOnly = n.datetime.split('T')[0];
                    allEvents.push({ title: 'üîî ' + n.title, date: dateOnly, description: n.description || '', alarm: true });
                }
            });
            // Add events
            state.events.forEach(e => {
                allEvents.push({ title: 'üìÖ ' + e.title, date: e.date, description: '', alarm: true });
            });
            // Add birthdays
            const currentYear = new Date().getFullYear();
            state.birthdays.forEach(b => {
                const monthDay = b.date.slice(5);
                allEvents.push({ title: 'üéÇ Cumplea√±os: ' + b.name, date: currentYear + '-' + monthDay, description: '', alarm: true });
            });
            if (allEvents.length === 0) { alert('No hay nada para exportar'); return; }
            const ics = generateICS(allEvents);
            downloadICS('finanzapp-todo.ics', ics);
            alert('‚úÖ Archivo descargado! \n\n√Åbrelo para a√±adir ' + allEvents.length + ' eventos a Calendars');
        }

        // Category Functions
        function addCategory(type) {
            const input = document.getElementById(type === 'expense' ? 'new-expense-cat' : 'new-income-cat');
            const name = input.value.trim();
            if (!name) return;
            const cats = type === 'expense' ? state.expenseCategories : state.incomeCategories;
            if (!cats.includes(name)) { cats.push(name); saveState(); updateUI(); }
            input.value = '';
        }
        function deleteCategory(type, name) {
            const cats = type === 'expense' ? state.expenseCategories : state.incomeCategories;
            const idx = cats.indexOf(name);
            if (idx > -1) { cats.splice(idx, 1); saveState(); updateUI(); }
        }

        // Wallet Functions
        function addWallet() {
            const name = document.getElementById('wallet-name').value.trim();
            const balance = parseFloat(document.getElementById('wallet-balance').value) || 0;
            if (!name) return;
            state.wallets.push({ name, balance });
            saveState(); updateUI();
            document.getElementById('wallet-name').value = '';
            document.getElementById('wallet-balance').value = '';
        }
        function makeTransfer() {
            const fromIdx = document.getElementById('transfer-from').value;
            const toIdx = document.getElementById('transfer-to').value;
            const amt = parseFloat(document.getElementById('transfer-amount').value);
            if (fromIdx === toIdx || !amt) return;
            state.wallets[fromIdx].balance -= amt;
            state.wallets[toIdx].balance += amt;
            saveState(); updateUI();
            document.getElementById('transfer-amount').value = '';
        }

        function addSubscription() {
            const name = document.getElementById('sub-name').value.trim();
            const amount = parseFloat(document.getElementById('sub-amount').value);
            if (!name || !amount) return;
            state.subscriptions.push({ name, amount });
            saveState(); updateUI();
            document.getElementById('sub-name').value = '';
            document.getElementById('sub-amount').value = '';
        }

        function addEvent() {
            const title = document.getElementById('event-title').value.trim();
            const date = document.getElementById('event-date').value;
            if (!title || !date) return;
            state.events.push({ title, date });
            saveState(); updateUI();
            document.getElementById('event-title').value = '';
            document.getElementById('event-date').value = '';
        }
        function addBirthday() {
            const name = document.getElementById('birthday-name').value.trim();
            const date = document.getElementById('birthday-date').value;
            if (!name || !date) return;
            state.birthdays.push({ name, date });
            saveState(); updateUI();
            document.getElementById('birthday-name').value = '';
            document.getElementById('birthday-date').value = '';
        }
        function addNote() {
            const text = document.getElementById('note-text').value.trim();
            if (!text) return;
            state.notes.push({ text, date: new Date().toISOString() });
            saveState(); updateUI();
            document.getElementById('note-text').value = '';
        }

        function renderCalendar() {
            const months = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            document.getElementById('calendar-month').textContent = months[state.currentMonth] + ' ' + state.currentYear;
            const firstDay = new Date(state.currentYear, state.currentMonth, 1).getDay();
            const daysInMonth = new Date(state.currentYear, state.currentMonth + 1, 0).getDate();
            const today = new Date();
            let html = '<div class="day-header">L</div><div class="day-header">M</div><div class="day-header">X</div><div class="day-header">J</div><div class="day-header">V</div><div class="day-header">S</div><div class="day-header">D</div>';
            const startDay = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < startDay; i++) html += '<div class="day"></div>';
            for (let d = 1; d <= daysInMonth; d++) {
                const isToday = d === today.getDate() && state.currentMonth === today.getMonth() && state.currentYear === today.getFullYear();
                const dateStr = `${state.currentYear}-${String(state.currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const hasEvent = state.events.some(e => e.date === dateStr) || state.birthdays.some(b => b.date.slice(5) === dateStr.slice(5));
                html += `<div class="day${isToday ? ' today' : ''}${hasEvent ? ' has-event' : ''}">${d}</div>`;
                            const turno = state.turnos && state.turnos[dateStr] ? state.turnos[dateStr] : null;
            }
            document.getElementById('calendar-grid').innerHTML = html;
            html += `<div class="day${isToday ? ' today' : ''}${hasEvent ? ' has-event' : ''}${turno ? ' shift-' + turno : ''}"><span>${d}</span></div>`;
        function updateUI() {
            document.getElementById('total-balance').textContent = '‚Ç¨' + state.balance.toFixed(2);
            const income = state.transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expense = state.transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            document.getElementById('total-income').textContent = '‚Ç¨' + income.toFixed(0);
            document.getElementById('total-expense').textContent = '‚Ç¨' + expense.toFixed(0);

            let rec = 'A√±ade transacciones para obtener recomendaciones.';
            if (state.transactions.length > 0) {
                if (expense > income * 0.8) rec = '‚ö†Ô∏è Tus gastos son altos. Considera reducir gastos no esenciales.';
                else if (income > expense * 2) rec = 'üåü ¬°Excelente! Est√°s ahorrando bien.';
                else rec = '‚úÖ Tu balance es saludable.';
            }
            document.getElementById('ia-recommendation').textContent = rec;

            document.getElementById('expense-categories-list').innerHTML = '<div class="categories-list">' + state.expenseCategories.map(c => `<span class="category-tag">${c}<button class="delete-btn" onclick="deleteCategory('expense','${c}')">‚úï</button></span>`).join('') + '</div>';
            document.getElementById('income-categories-list').innerHTML = '<div class="categories-list">' + state.incomeCategories.map(c => `<span class="category-tag">${c}<button class="delete-btn" onclick="deleteCategory('income','${c}')">‚úï</button></span>`).join('') + '</div>';

            updateNotifStatus();
            document.getElementById('notifications-list').innerHTML = state.notifications.map((n, i) => {
                const dt = n.datetime ? new Date(n.datetime).toLocaleString('es-ES') : 'Sin fecha';
                const repeatText = { none: '', daily: ' (Diario)', weekly: ' (Semanal)', monthly: ' (Mensual)' }[n.repeat] || '';
                return `<div class="notification-item"><div class="info"><span class="title">${n.title}</span><span class="details">${dt}${repeatText}</span></div><div class="actions"><button class="edit-btn" onclick="openNotifModal(${i})">‚úèÔ∏è</button><button class="delete-btn" onclick="deleteNotification(${i})">üóëÔ∏è</button></div></div>`;
            }).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay notificaciones</p>';

            const catTotals = {};
            state.transactions.filter(t => t.type === 'expense').forEach(t => { catTotals[t.category] = (catTotals[t.category] || 0) + t.amount; });
            document.getElementById('category-breakdown').innerHTML = Object.entries(catTotals).map(([cat, amt]) => `<div class="transaction-item"><div class="info"><span class="name">${cat}</span></div><span class="amount expense">‚Ç¨${amt.toFixed(2)}</span></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay gastos</p>';

            document.getElementById('recent-transactions').innerHTML = state.transactions.slice(0, 20).map((t, i) => {
                const d = new Date(t.date).toLocaleDateString('es-ES');
                return `<div class="transaction-item"><div class="info"><span class="name">${t.category}</span><span class="details">${t.description || d}</span></div><span class="amount ${t.type}">${t.type === 'expense' ? '-' : '+'}‚Ç¨${t.amount.toFixed(2)}</span><div class="actions"><button class="edit-btn" onclick="openEditModal(${i})">‚úèÔ∏è</button><button class="delete-btn" onclick="deleteTransaction(${i})">üóëÔ∏è</button></div></div>`;
            }).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay transacciones</p>';

            document.getElementById('subscriptions-list').innerHTML = state.subscriptions.map(s => `<div class="transaction-item"><div class="info"><span class="name">${s.name}</span></div><span class="amount expense">‚Ç¨${s.amount.toFixed(2)}/mes</span></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay suscripciones</p>';

            document.getElementById('wallets-list').innerHTML = state.wallets.map(w => `<div class="wallet-item"><div class="info"><span class="name">${w.name}</span><span class="balance">‚Ç¨${w.balance.toFixed(2)}</span></div></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay carteras</p>';
            const walletOpts = state.wallets.map((w, i) => `<option value="${i}">${w.name}</option>`).join('');
            document.getElementById('transfer-from').innerHTML = walletOpts;
            document.getElementById('transfer-to').innerHTML = walletOpts;

            document.getElementById('events-list').innerHTML = state.events.map(e => `<div class="transaction-item"><div class="info"><span class="name">${e.title}</span><span class="details">${e.date}</span></div></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay eventos</p>';
            document.getElementById('birthdays-list').innerHTML = state.birthdays.map(b => `<div class="transaction-item"><div class="info"><span class="name">${b.name}</span><span class="details">${b.date}</span></div></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay cumplea√±os</p>';
            document.getElementById('notes-list').innerHTML = state.notes.map(n => `<div class="card" style="margin-bottom:8px;padding:12px;"><p style="font-size:14px;">${n.text}</p><small style="color:var(--text-secondary);">${new Date(n.date).toLocaleDateString('es-ES')}</small></div>`).join('') || '<p style="color:var(--text-secondary);font-size:13px;">No hay notas</p>';

            renderCalendar();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            if (state.theme === 'light') document.body.setAttribute('data-theme', 'light');
            updateUI();
            enterQuickMode();
        });

        document.getElementById('edit-type').addEventListener('change', updateEditCategories);
// 
        // Cuando vuelves a la app (sin haberla cerrado), mostrar modo rapido
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                enterQuickMode();
            }
        });

    // ============ SERVICE WORKER Y NOTIFICACIONES ============
    // Registrar Service Worker para notificaciones push en iOS
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
            .then(function(registration) {
                console.log('Service Worker registrado con exito:', registration.scope);
            })
            .catch(function(error) {
                console.log('Error al registrar Service Worker:', error);
            });
    }

    // Funcion para solicitar permiso de notificaciones
    async function solicitarPermisoNotificaciones() {
        if ('Notification' in window) {
            const permiso = await Notification.requestPermission();
            if (permiso === 'granted') {
                console.log('Permiso de notificaciones concedido');
                // Mostrar notificacion de prueba
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.ready.then(function(registration) {
                        registration.showNotification('FinanzApp', {
                            body: 'Notificaciones activadas correctamente',
                            icon: '6a043b00-9e61-40c9-acd5-5056901dcf4e.jfif'
                        });
                    });
                }
            }
            return permiso;
        }
        return 'not-supported';
    }

    // Solicitar permiso automaticamente al cargar (solo si no se ha pedido antes)
    if ('Notification' in window && Notification.permission === 'default') {
        // Esperar 3 segundos antes de pedir permiso para mejor UX
        setTimeout(() => {
            solicitarPermisoNotificaciones();
        }, 3000);
    }

// ============ NUEVAS FUNCIONES PARA CENTIMOS Y TURNOS ============

// Funcion para agregar centimos al monto rapido
function quickAddCents(cents) {
    const currentAmt = parseFloat(quickAmount) || 0;
    quickAmount = (currentAmt + cents).toFixed(2);
    updateQuickUI();
}

// Modificar quickSetType para mostrar/ocultar botones de centimos
const originalQuickSetType = quickSetType;
quickSetType = function(type) {
    originalQuickSetType(type);
    // Mostrar botones de centimos solo para gastos
    const centBtns = document.getElementById('quick-cent-btns');
    if (centBtns) {
        centBtns.style.display = (type === 'expense') ? 'flex' : 'none';
    }
};

// Agregar turnos al state
if (!state.turnos) {
    state.turnos = {}; // formato: { '2025-12-01': 'manana', '2025-12-02': 'tarde', ... }
}

// Funcion para agregar/cambiar turno de un dia
function setTurno(dateStr, turno) {
    if (!turno || turno === 'none') {
        delete state.turnos[dateStr];
    } else {
        state.turnos[dateStr] = turno;
    }
    saveState();
    renderCalendar();
}

// Selector de turno para el dia actual (agregar en calendar interface)
let selectedCalendarDate = null;
function showTurnoSelector(dateStr) {
    selectedCalendarDate = dateStr;
    const currentTurno = state.turnos[dateStr] || 'none';
    
    // Crear modal simple para seleccionar turno
    const turnoHtml = `
        <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:2000;display:flex;align-items:center;justify-content:center;" onclick="this.remove()">
            <div class="card" style="min-width:280px;padding:20px;" onclick="event.stopPropagation()">
                <h3 style="margin-bottom:16px;">Turno del ${dateStr}</h3>
                <div class="turno-btns" style="display:flex;gap:8px;margin-bottom:12px;">
                    <button class="turno-btn ${currentTurno === 'manana' ? 'active manana' : ''}" onclick="setTurno('${dateStr}', 'manana'); this.closest('div[style*=fixed]').remove();">üåÖ Ma√±ana</button>
                    <button class="turno-btn ${currentTurno === 'tarde' ? 'active tarde' : ''}" onclick="setTurno('${dateStr}', 'tarde'); this.closest('div[style*=fixed]').remove();">‚òÄÔ∏è Tarde</button>
                    <button class="turno-btn ${currentTurno === 'noche' ? 'active noche' : ''}" onclick="setTurno('${dateStr}', 'noche'); this.closest('div[style*=fixed]').remove();">üåô Noche</button>
                </div>
                <button class="btn btn-secondary" style="width:100%;" onclick="setTurno('${dateStr}', 'none'); this.closest('div[style*=fixed]').remove();">Borrar</button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', turnoHtml);
}


// Mejorar renderCalendar para agregar indicadores de turnos y onclick
const originalRenderCalendar = renderCalendar;
renderCalendar = function() {
    const months = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
    document.getElementById('calendar-month').textContent = months[state.currentMonth] + ' ' + state.currentYear;
    
    const firstDay = new Date(state.currentYear, state.currentMonth, 1).getDay();
    const daysInMonth = new Date(state.currentYear, state.currentMonth + 1, 0).getDate();
    const today = new Date();
    
    let html = '<div class="day-header">L</div><div class="day-header">M</div><div class="day-header">X</div><div class="day-header">J</div><div class="day-header">V</div><div class="day-header">S</div><div class="day-header">D</div>';
    
    const startDay = firstDay === 0 ? 6 : firstDay - 1;
    for (let i = 0; i < startDay; i++) html += '<div class="day"></div>';
    
    for (let d = 1; d <= daysInMonth; d++) {
        const isToday = d === today.getDate() && state.currentMonth === today.getMonth() && state.currentYear === today.getFullYear();
        const dateStr = `${state.currentYear}-${String(state.currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const hasEvent = state.events.some(e => e.date === dateStr) || state.birthdays.some(b => b.date.slice(5) === dateStr.slice(5));
        const hasTurno = state.turnos && state.turnos[dateStr];
        
        let dayClasses = 'day';
        if (isToday) dayClasses += ' today';
        if (hasEvent) dayClasses += ' has-event';
            if (hasTurno) dayClasses += ' shift-' + hasTurno;        
        html += `<div class="${dayClasses}" onclick="showTurnoSelector('${dateStr}')">${d}</div>`;
    }
    
    document.getElementById('calendar-grid').innerHTML = html;
};

    </script>
</body>
</html>
